<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>글 작성하기</title>
    <link
      rel="stylesheet"
      href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css"
    />
  </head>
  <body>
    <header>
      <h1>Mini Blog - 새 글 작성</h1>
      <div id="header-buttons">
        <button onclick="history.back()">이전 화면으로 가기</button>
      </div>
    </header>
    <h1>글 작성하기</h1>

    <input type="text" id="title" placeholder="제목 입력" /><br /><br />

    <select id="category" required>
      <option value="">카테고리 선택</option>
      <option value="JavaScript">JavaScript</option>
      <option value="Node.js">Node.js</option>
      <option value="HTML">HTML</option></select
    ><br /><br />

    <div id="editor"></div>
    <br />

    <button onclick="submitPost()">작성 완료</button>

    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script>
      const editor = new toastui.Editor({
        el: document.querySelector("#editor"),
        height: "400px",
        initialEditType: "wysiwyg",
        previewStyle: "vertical",
      });

      function submitPost() {
        const title = document.getElementById("title").value.trim();
        const category = document.getElementById("category").value.trim();
        const content = editor.getMarkdown().trim();

        if (!title || !content || !category) {
          alert("제목, 카테고리, 내용을 모두 입력하세요.");
          return;
        }

        const postData = { title, category, content };

        fetch("/api/posts", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(postData),
        })
          .then((response) => {
            if (response.ok) {
              alert("글 작성 완료");
              window.location.href = "/";
            } else {
              throw new Error("글 작성 실패");
            }
          })
          .catch((error) => {
            console.error("에러 발생:", error);
            alert("글 작성 중 문제가 발생했습니다.");
          });
      }
    </script>
  </body>
</html>
